import{c as J,w as K,r as d,R as Q,j as a,a as e,aL as y,aM as B,aN as j,b as X,aO as $,B as ee}from"./index-3039c611.js";import{T as te,M as ae}from"./index-8a8a8c50.js";import{d as g}from"./dayjs.min-74dca8f8.js";import{F as r,r as se,C as ne,R as F,a as A,b as le,c as ie,L as I,A as P,M as q,d as re}from"./relativeTime-87fd74fa.js";import{P as oe}from"./PageDesc-04c4ecde.js";import"./RightOutlined-d58f713e.js";const ce=o=>{const[L,T]=d.useState([]),[n,x]=d.useState({_id:"",pid:"-1"}),[E,C]=d.useState(0),[b,k]=d.useState(1),[w,z]=d.useState(10),[M,U]=d.useState(1),[O,de]=d.useState("cm"),[R]=r.useForm(),[_]=r.useForm(),N=d.useRef(null);g.extend(se);const Y=Q.useRef();d.useEffect(()=>{Y.current&&window.scroll({top:Y.current.offsetTop-80||0,left:0,behavior:"smooth"})},[]),d.useEffect(()=>{o.BlogActions.asyncMessageListAction(b,w,1).then(t=>{let{data:i,totalCount:m,page:p,pageSize:s}=t.data;i.map(c=>{c.messageTime=g(c.messageTime*1e3).format("YYYY-MM-DD HH:mm:ss"),c.children.map(l=>{l.messageTime=g(l.messageTime*1e3).format("YYYY-MM-DD HH:mm:ss")})}),T(i),C(m),k(p),z(s)})},[b,w,o.BlogActions]);const W=t=>{o.BlogActions.asyncMessageInsertAction({pid:n.pid,targetReplayId:n._id||"-1",targetReplayContent:"",currentReplayContent:t.content,auditTime:0,auditStatus:"1",avatar:"http://dummyimage.com/100x100",email:t.email,nickName:t.nickname}).then(()=>{setTimeout(()=>{$.success("留言成功~"),M===1&&_.resetFields(),M===2&&(x({_id:"",pid:"-1"}),R.resetFields()),o.BlogActions.asyncMessageListAction(b,w,1).then(c=>{let{data:l,totalCount:u,page:f,pageSize:v}=c.data;l.map(h=>{h.messageTime=g(h.messageTime*1e3).format("YYYY-MM-DD HH:mm:ss"),h.children.map(S=>{S.messageTime=g(S.messageTime*1e3).format("YYYY-MM-DD HH:mm:ss")})}),T(l),C(u),k(f),z(v)});let i="haoju.zhang@outlook.com",m=`您的博客收到来自${t.nickname}<${t.email}>的留言`,s=`<div><br /><p>您在<span style="color: cadetblue; padding: 3px">夜雨炊烟</span>博客上收到新的留言</p><hr /><span style="color: cadetblue;">${t.nickname}:</span><p style="width: 98%;min-height: 30px;padding-top: 10px;padding-left: 10px;padding-bottom: 10px;background-color: #f5f5f5;border-radius: 10px;"><span>${t.content}</span></p><p><a href="https://yychuiyan.com/rblog/message"target="_blank"style="text-decoration: none; color: #5c8fef">点击查看详情</a></p></div>`.split(`
`).join(`
<br/>
`);o.BlogActions.asyncSendMailAction({email:i,subject:m,html:s})},500)})},D=()=>{},H=t=>{x(t),R.resetFields(),N&&setTimeout(()=>{var i;(i=N==null?void 0:N.current)==null||i.scrollIntoView({behavior:"smooth",block:"center",inline:"center"})},100)},V=t=>{U(2),o.BlogActions.asyncMessageInsertAction({pid:n.pid==="-1"?n._id:n.pid,targetReplayId:n._id||"-1",targetReplayContent:`${t==null?void 0:t.nickname}@${n==null?void 0:n.nickName} ${n==null?void 0:n.currentReplayContent}`,currentReplayContent:t.content,auditTime:0,auditStatus:"1",avatar:"http://dummyimage.com/100x100",email:t.email,nickName:t.nickname}).then(()=>{setTimeout(()=>{$.success("回复成功~"),M===1&&_.resetFields(),M===2&&(x({_id:"",pid:"-1"}),R.resetFields()),o.BlogActions.asyncMessageListAction(b,w,1).then(c=>{let{data:l,totalCount:u,page:f,pageSize:v}=c.data;l.map(h=>{h.messageTime=g(h.messageTime*1e3).format("YYYY-MM-DD HH:mm:ss"),h.children.map(S=>{S.messageTime=g(S.messageTime*1e3).format("YYYY-MM-DD HH:mm:ss")})}),T(l),x(l),C(u),k(f),z(v)});let i=n.email,m="您在夜雨炊烟小站中的留言收到了回复",s=`<div><br /><p>您在<span style="color: cadetblue; padding: 3px">夜雨炊烟</span>博客中的留言：</p><hr /><p style="width: 98%;min-height: 30px;padding-top: 10px;padding-left: 10px;padding-bottom: 10px;background-color: #f5f5f5;border-radius: 10px;"><span>${n.currentReplayContent}</span></p>收到<span style="color: cadetblue; padding-right:2px;">${t.nickname}</span>的回复:<p style="width: 98%;min-height: 30px;padding-top: 10px;padding-left: 10px;padding-bottom: 10px;background-color: #f5f5f5;border-radius: 10px;"><span>${t.content}</span></p><p><a href="https://yychuiyan.com/rblog/message"target="_blank"style="text-decoration: none; color: #5c8fef">点击查看详情</a></p></div>`.split(`
`).join(`
<br/>
`);o.BlogActions.asyncSendMailAction({email:i,subject:m,html:s})},500)}),Z()},Z=()=>{x({_id:"",pid:"-1"})},G=(t,i)=>{o.BlogActions.asyncArticleCommentsAction(t,i,1).then(m=>{let{data:p,totalCount:s,page:c,pageSize:l}=m.data;T(p),C(s),k(c),z(l)})};return a("div",{className:"w-1200 mx-auto pb-5 lg:w-full lg:mx-5 sm:w-full",ref:Y,children:[e(oe,{title:"留言板"}),e("div",{className:"w-1000 mx-auto mt-10 lg:w-full sm:w-full",children:a(ne,{className:" rounded-2xl bg-base-100",children:[a("div",{style:{textAlign:"center",fontSize:"16px",fontWeight:"bolder",marginBottom:"24px",position:"relative"},className:"lg:w-full sm:w-full",children:[e("p",{className:"text-xl",style:{userSelect:"none"},children:"欢迎留言~"}),e("div",{className:"h-36 px-20 mt-5 font-normal lg:px-0",children:a("div",{className:"flex flex-col items-start w-[100%]  absolute",children:[e("p",{className:"flex absolute text-xl",children:"本站信息:"}),a("div",{className:"flex items-start justify-center flex-col w-800 mt-8 bg-base-200  rounded-xl hover:transition hover:duration-500 hover:shadow cursor-pointer lg:w-full",children:[a("p",{className:"pl-2 py-1",children:[e("span",{children:"name: "}),e("span",{children:"夜雨炊烟"})]}),a("p",{className:"pl-2 pb-1",children:[e("span",{children:"link: "}),e("span",{children:"https://yychuiyan.com/"})]}),a("p",{className:"pl-2 pb-1 lg:flex lg:flex-col lg:items-start",children:[e("span",{children:"avatar: "}),e("span",{children:"https://op.yychuiyan.com/avatar.webp"})]}),a("p",{className:"pl-2 pb-1",children:[e("span",{children:"desc: "}),e("span",{children:"三餐烟火暖，四季皆安然。"})]})]})]})})]}),a(r,{name:"basic",form:_,onFinish:W,onFinishFailed:D,className:"w-800 mx-auto  lg:w-full sm:w-full",children:[a(F,{children:[e(A,{span:12,className:"pr-2 mt-5 lg:mt-8",children:e(r.Item,{label:"",name:"nickname",rules:[{required:!0,message:"请输入你的昵称"},{whitespace:!0,message:"输入不能为空"},{min:2,message:"昵称不能小于2个字符"},{max:30,message:"主题不能大于30个字符"}],children:e(y,{maxLength:30,placeholder:"请输入你的昵称"})})}),e(A,{span:12,className:"pl-2 mt-5 lg:mt-8",children:e(r.Item,{label:"",name:"email",rules:[{required:!0,message:"请输入邮箱"},{pattern:/^[a-zA-Z0-9_.-]+@[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*\.[a-zA-Z0-9]{2,6}$/,message:"邮箱格式不正确"}],children:e(y,{maxLength:30,placeholder:"请输入你的邮箱"})})})]}),e(r.Item,{label:"",name:"content",rules:[{required:!0,message:"请输入你的内容"},{whitespace:!0,message:"留言不能为空"}],children:e(y.TextArea,{placeholder:"请输入留言内容",autoSize:{minRows:6,maxRows:12}})}),e(r.Item,{className:"",children:a(B,{type:"primary",htmlType:"submit",className:"w-800 mx-auto lg:w-full sm:w-full",children:[e(le,{})," 提交留言"]})})]}),e(F,{className:"mt:h-4 w-full mx-auto lg:w-full sm:w-full",children:a(A,{span:24,className:"sm:w-full lg:w-full",children:[a("b",{style:{marginBottom:"24px",color:"var(--color-icon-default)",userSelect:"none"},children:["留言展示 ",e(ie,{})]}),L.length>0?e(I,{itemLayout:"horizontal",className:"sm:w-full lg:w-full",dataSource:L,renderItem:(t,i)=>{var m,p;return e(I.Item,{actions:[],children:e(I.Item.Meta,{avatar:e(P,{style:{backgroundColor:"#1890ff",userSelect:"none"},children:(p=(m=t.nickName)==null?void 0:m.slice(0,1))==null?void 0:p.toUpperCase()}),title:e("b",{style:{color:"var(--color-icon-default)",userSelect:"none"},children:t.nickName}),description:a(j,{children:[e("div",{className:"user_content font-normal lg:w-full",children:e("pre",{className:"lg:overflow-auto",dangerouslySetInnerHTML:{__html:t.currentReplayContent.replace(/((http|https):\/\/[-A-Za-z0-9+&@#/%?=~_|!:,.;]+[-A-Za-z0-9+&@#/%=~_|])/g,s=>"<a href='"+s+"' target='_blank'>"+s+"</a>")}})}),a("div",{className:"sm:w-full lg:w-full",style:{fontSize:"12px",marginTop:"8px",marginBottom:"16px",alignItems:"center",display:"flex",flexWrap:"wrap",justifyContent:"space-between"},children:[a("span",{className:"user_desc",style:{userSelect:"none"},children:["用户 ",t.nickName,"  发表于 ",t.messageTime]}),e("span",{children:a("a",{style:{fontSize:"12px",marginRight:"12px"},onClick:()=>H(t),children:[e(q,{}),"  回复"]})})]}),t.children&&t.children.length?e(j,{children:t.children.map((s,c)=>{var l,u;return e(re,{className:"bg-base-100",author:e("span",{className:"replay_title",style:{userSelect:"none"},children:s.targetReplayContent.substring(0,40)+"···"}),avatar:e(P,{style:{backgroundColor:"#1890ff",userSelect:"none"},children:(u=(l=s.nickName)==null?void 0:l.slice(0,1))==null?void 0:u.toUpperCase()}),content:e("span",{className:"user_content font-normal",children:e("pre",{className:"lg:overflow-auto",dangerouslySetInnerHTML:{__html:s.currentReplayContent.replace(/((http|https):\/\/[-A-Za-z0-9+&@#/%?=~_|!:,.;]+[-A-Za-z0-9+&@#/%=~_|])/g,f=>"<a href='"+f+"' target='_blank'>"+f+"</a>")}})}),datetime:e(te,{title:s.messageTime,children:e("span",{style:{userSelect:"none"},children:g(s.messageTime).fromNow()})}),actions:[a("a",{style:{fontSize:"12px",marginRight:"12px"},onClick:()=>H(s),children:[e(q,{}),"  回复"]})]},c)})}):null,n._id===t._id||n.pid===t._id?e("div",{style:{marginTop:"12px"},ref:N,children:a(r,{form:R,name:"reply",onFinish:V,onFinishFailed:D,children:[a(F,{children:[e(A,{span:12,className:"pr-2",children:e(r.Item,{label:"",name:"nickname",rules:[{required:!0,message:"请输入你的昵称"},{whitespace:!0,message:"输入不能为空"},{min:2,message:"昵称不能小于2个字符"},{max:30,message:"主题不能大于30个字符"}],children:e(y,{maxLength:30,placeholder:"请输入你的昵称"})})}),e(A,{span:12,className:"pl-2",children:e(r.Item,{label:"",name:"email",rules:[{required:!0,message:"请输入邮箱"},{pattern:/^[a-zA-Z0-9_.-]+@[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*\.[a-zA-Z0-9]{2,6}$/,message:"邮箱格式不正确"}],children:e(y,{maxLength:30,placeholder:"请输入你的邮箱"})})})]}),e(r.Item,{label:"",name:"content",rules:[{required:!0,message:"请输入你的内容"},{whitespace:!0,message:"输入不能为空"}],children:e(y.TextArea,{placeholder:"请输入留言内容",autoSize:{minRows:6,maxRows:12}})}),e(r.Item,{children:a("div",{style:{display:"flex",justifyContent:"flex-end"},children:[e(B,{style:{marginRight:"12px"},onClick:()=>Z(),children:"取消"}),e(B,{type:"primary",htmlType:"submit",children:" 回复"})]})}),e(r.Item,{})]})}):null]})})},i)}}):e("div",{className:"flex justify-center",children:"暂无留言~"}),e(ae,{text:O,pageSize:w,currentPage:b,total:E,onChange:G})]})})]})})]})},me=o=>({BlogActions:X(ee,o)}),xe=J(null,me)(K(ce));export{xe as default};
