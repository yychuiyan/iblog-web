import{c as O,w as V,r as p,R as G,j as t,a as e,aH as y,aI as v,aJ as Z,b as Q,aK as $,B as X}from"./index-fc8c8dba.js";import{T as ee,M as ae}from"./index-c1d59f11.js";import{d as g}from"./dayjs.min-14dde7c2.js";import{F as r,r as te,C as se,R as I,a as T,b as le,c as ne,L as B,A as q,M as P,d as ie}from"./relativeTime-efa5e3ee.js";import{P as re}from"./PageDesc-2a773682.js";import"./RightOutlined-514d34a4.js";const ce=c=>{const[F,C]=p.useState([]),[l,x]=p.useState({_id:"",pid:"-1"}),[j,S]=p.useState(0),[w,z]=p.useState(1),[b,M]=p.useState(10),[R,E]=p.useState(1),[U,me]=p.useState("cm"),[_]=r.useForm(),[k]=r.useForm(),N=p.useRef(null);g.extend(te);const Y=G.useRef();p.useEffect(()=>{Y.current&&window.scroll({top:Y.current.offsetTop-80||0,left:0,behavior:"smooth"})},[]),p.useEffect(()=>{c.BlogActions.asyncMessageListAction(w,b,1).then(a=>{let{data:i,totalCount:m,page:d,pageSize:s}=a.data;i.map(n=>{n.messageTime=g(n.messageTime*1e3).format("YYYY-MM-DD HH:mm:ss"),n.children.map(o=>{o.messageTime=g(o.messageTime*1e3).format("YYYY-MM-DD HH:mm:ss")})}),C(i),S(m),z(d),M(s)})},[w,b,c.BlogActions]);const W=a=>{c.BlogActions.asyncMessageInsertAction({pid:l.pid,targetReplayId:l._id||"-1",targetReplayContent:"",currentReplayContent:a.content,auditTime:0,auditStatus:"1",avatar:"http://dummyimage.com/100x100",email:a.email,nickName:a.nickname}).then(()=>{setTimeout(()=>{$.success("留言成功!"),R===1&&k.resetFields(),R===2&&(x({_id:"",pid:"-1"}),_.resetFields()),c.BlogActions.asyncMessageListAction(w,b,1).then(s=>{let{data:n,totalCount:o,page:u,pageSize:f}=s.data;n.map(h=>{h.messageTime=g(h.messageTime*1e3).format("YYYY-MM-DD HH:mm:ss"),h.children.map(A=>{A.messageTime=g(A.messageTime*1e3).format("YYYY-MM-DD HH:mm:ss")})}),C(n),S(o),z(u),M(f)});let i="haoju.zhang@outlook.com",m=`收到来自${a.nickname}<${a.email}>的留言`,d=`<div><p>${a.content}</p><p><a href="https://yychuiyan.com/rblog/message" target="_blank">查看详情</a></p></div>`;c.BlogActions.asyncSendMailAction(i,m,d)},500)})},H=()=>{},D=a=>{x(a),_.resetFields(),N&&setTimeout(()=>{var i;(i=N==null?void 0:N.current)==null||i.scrollIntoView({behavior:"smooth",block:"center",inline:"center"})},100)},J=a=>{E(2),c.BlogActions.asyncMessageInsertAction({pid:l.pid==="-1"?l._id:l.pid,targetReplayId:l._id||"-1",targetReplayContent:`${a==null?void 0:a.nickname}@${l==null?void 0:l.nickName} ${l==null?void 0:l.currentReplayContent}`,currentReplayContent:a.content,auditTime:0,auditStatus:"1",avatar:"http://dummyimage.com/100x100",email:a.email,nickName:a.nickname}).then(()=>{setTimeout(()=>{$.success("回复成功!"),R===1&&k.resetFields(),R===2&&(x({_id:"",pid:"-1"}),_.resetFields()),c.BlogActions.asyncMessageListAction(w,b,1).then(s=>{let{data:n,totalCount:o,page:u,pageSize:f}=s.data;n.map(h=>{h.messageTime=g(h.messageTime*1e3).format("YYYY-MM-DD HH:mm:ss"),h.children.map(A=>{A.messageTime=g(A.messageTime*1e3).format("YYYY-MM-DD HH:mm:ss")})}),C(n),x(n),S(o),z(u),M(f)});let i=l.email,m=`收到来自${a.nickname}的回复`,d=`<div><p><b>${a.nickname}</b>在<b>夜雨炊烟</b>小站中回复了你的留言信息：<q><cite>${l.currentReplayContent}</cite></q></p><hr><p>${a.content}</p><p><a href="https://yychuiyan.com/rblog/message" target="_blank">查看详情</a></p></p></div>`;c.BlogActions.asyncSendMailAction(i,m,d)},500)}),L()},L=()=>{x({_id:"",pid:"-1"})},K=(a,i)=>{c.BlogActions.asyncArticleCommentsAction(a,i,1).then(m=>{let{data:d,totalCount:s,page:n,pageSize:o}=m.data;C(d),S(s),z(n),M(o)})};return t("div",{className:"w-1200 mx-auto pb-5 lg:w-full lg:mx-5 sm:w-full",ref:Y,children:[e(re,{title:"留言板"}),e("div",{className:"w-1000 mx-auto mt-10 lg:w-full sm:w-full",children:t(se,{className:" rounded-2xl bg-base-100",children:[t("div",{style:{textAlign:"center",fontSize:"16px",fontWeight:"bolder",marginBottom:"24px",position:"relative"},className:"lg:w-full sm:w-full",children:[e("p",{className:"text-xl",style:{userSelect:"none"},children:"欢迎留言~"}),e("div",{className:"h-36 px-20 mt-5 font-normal lg:px-0",children:t("div",{className:"flex flex-col items-start w-[100%]  absolute",children:[e("p",{className:"flex absolute text-xl",children:"本站信息:"}),t("div",{className:"flex items-start justify-center flex-col w-800 mt-8 bg-base-200  rounded-xl hover:transition hover:duration-500 hover:shadow cursor-pointer lg:w-full",children:[t("p",{className:"pl-2 py-1",children:[e("span",{children:"name: "}),e("span",{children:"夜雨炊烟"})]}),t("p",{className:"pl-2 pb-1",children:[e("span",{children:"link: "}),e("span",{children:"https://yychuiyan.com/"})]}),t("p",{className:"pl-2 pb-1 lg:flex lg:flex-col lg:items-start",children:[e("span",{children:"avatar: "}),e("span",{children:"https://op.yychuiyan.com/avatar.webp"})]}),t("p",{className:"pl-2 pb-1",children:[e("span",{children:"desc: "}),e("span",{children:"三餐烟火暖，四季皆安然。"})]})]})]})})]}),t(r,{name:"basic",form:k,onFinish:W,onFinishFailed:H,className:"w-800 mx-auto  lg:w-full sm:w-full",children:[t(I,{children:[e(T,{span:12,className:"pr-2 mt-5 lg:mt-8",children:e(r.Item,{label:"",name:"nickname",rules:[{required:!0,message:"请输入你的昵称"},{whitespace:!0,message:"输入不能为空"},{min:2,message:"昵称不能小于2个字符"},{max:30,message:"主题不能大于30个字符"}],children:e(y,{maxLength:30,placeholder:"请输入你的昵称"})})}),e(T,{span:12,className:"pl-2 mt-5 lg:mt-8",children:e(r.Item,{label:"",name:"email",rules:[{required:!0,message:"请输入邮箱"},{pattern:/^[a-zA-Z0-9_.-]+@[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*\.[a-zA-Z0-9]{2,6}$/,message:"邮箱格式不正确"}],children:e(y,{maxLength:30,placeholder:"请输入你的邮箱"})})})]}),e(r.Item,{label:"",name:"content",rules:[{required:!0,message:"请输入你的内容"},{whitespace:!0,message:"留言不能为空"}],children:e(y.TextArea,{placeholder:"请输入留言内容",autoSize:{minRows:6,maxRows:12}})}),e(r.Item,{className:"",children:t(v,{type:"primary",htmlType:"submit",className:"w-800 mx-auto lg:w-full sm:w-full",children:[e(le,{})," 提交留言"]})})]}),e(I,{className:"mt:h-4 w-full mx-auto lg:w-full sm:w-full",style:{userSelect:"none"},children:t(T,{span:24,className:"sm:w-full lg:w-full",children:[t("b",{style:{marginBottom:"24px",color:"var(--color-icon-default)"},children:["留言展示 ",e(ne,{})]}),F.length>0?e(B,{itemLayout:"horizontal",className:"sm:w-full lg:w-full",dataSource:F,renderItem:(a,i)=>{var m,d;return e(B.Item,{actions:[],children:e(B.Item.Meta,{avatar:e(q,{style:{backgroundColor:"#1890ff"},children:(d=(m=a.nickName)==null?void 0:m.slice(0,1))==null?void 0:d.toUpperCase()}),title:e("b",{style:{color:"var(--color-icon-default)"},children:a.nickName}),description:t(Z,{children:[e("div",{className:"user_content font-normal lg:w-full",children:e("pre",{className:"lg:overflow-auto",dangerouslySetInnerHTML:{__html:a.currentReplayContent.replace(/((http|https):\/\/[-A-Za-z0-9+&@#/%?=~_|!:,.;]+[-A-Za-z0-9+&@#/%=~_|])/g,s=>"<a href='"+s+"' target='_blank'>"+s+"</a>")}})}),t("div",{className:"sm:w-full lg:w-full",style:{fontSize:"12px",marginTop:"8px",marginBottom:"16px",alignItems:"center",display:"flex",flexWrap:"wrap",justifyContent:"space-between"},children:[t("span",{className:"user_desc",children:["用户 ",a.nickName,"  发表于 ",a.messageTime]}),e("span",{children:t("a",{style:{fontSize:"12px",marginRight:"12px"},onClick:()=>D(a),children:[e(P,{}),"  回复"]})})]}),a.children&&a.children.length?e(Z,{children:a.children.map((s,n)=>{var o,u;return e(ie,{className:"bg-base-100",author:e("span",{className:"replay_title",children:s.targetReplayContent.substring(0,40)+"···"}),avatar:e(q,{style:{backgroundColor:"#1890ff"},children:(u=(o=s.nickName)==null?void 0:o.slice(0,1))==null?void 0:u.toUpperCase()}),content:e("span",{className:"user_content font-normal",children:e("pre",{className:"lg:overflow-auto",dangerouslySetInnerHTML:{__html:s.currentReplayContent.replace(/((http|https):\/\/[-A-Za-z0-9+&@#/%?=~_|!:,.;]+[-A-Za-z0-9+&@#/%=~_|])/g,f=>"<a href='"+f+"' target='_blank'>"+f+"</a>")}})}),datetime:e(ee,{title:s.messageTime,children:e("span",{children:g(s.messageTime).fromNow()})}),actions:[t("a",{style:{fontSize:"12px",marginRight:"12px"},onClick:()=>D(s),children:[e(P,{}),"  回复"]})]},n)})}):null,l._id===a._id||l.pid===a._id?e("div",{style:{marginTop:"12px"},ref:N,children:t(r,{form:_,name:"reply",onFinish:J,onFinishFailed:H,children:[t(I,{children:[e(T,{span:12,className:"pr-2",children:e(r.Item,{label:"",name:"nickname",rules:[{required:!0,message:"请输入你的昵称"},{whitespace:!0,message:"输入不能为空"},{min:2,message:"昵称不能小于2个字符"},{max:30,message:"主题不能大于30个字符"}],children:e(y,{maxLength:30,placeholder:"请输入你的昵称"})})}),e(T,{span:12,className:"pl-2",children:e(r.Item,{label:"",name:"email",rules:[{required:!0,message:"请输入邮箱"},{pattern:/^[a-zA-Z0-9_.-]+@[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*\.[a-zA-Z0-9]{2,6}$/,message:"邮箱格式不正确"}],children:e(y,{maxLength:30,placeholder:"请输入你的邮箱"})})})]}),e(r.Item,{label:"",name:"content",rules:[{required:!0,message:"请输入你的内容"},{whitespace:!0,message:"输入不能为空"}],children:e(y.TextArea,{placeholder:"请输入留言内容",autoSize:{minRows:6,maxRows:12}})}),e(r.Item,{children:t("div",{style:{display:"flex",justifyContent:"flex-end"},children:[e(v,{style:{marginRight:"12px"},onClick:()=>L(),children:"取消"}),e(v,{type:"primary",htmlType:"submit",children:" 回复"})]})}),e(r.Item,{})]})}):null]})})},i)}}):e("div",{className:"flex justify-center",children:"暂无留言~"}),e(ae,{text:U,pageSize:b,currentPage:w,total:j,onChange:K})]})})]})})]})},oe=c=>({BlogActions:Q(X,c)}),ye=O(null,oe)(V(ce));export{ye as default};
