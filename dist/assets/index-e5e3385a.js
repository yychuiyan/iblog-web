import{B as pe,D as me,p as l,J as i,R as se,w as _e,t as a,v as e,K as Fe,L as Me,M as B,N as v,O as f,P as le,I as oe,Q as E,S as y,T as re,U as ze,z as x}from"./index-3279762d.js";import{a as ce,M as Te}from"./index-cfe2545f.js";import{d as F}from"./dayjs.min-0a35cdf3.js";import{r as je,u as Le,C as Ie,e as ie,a as Ae,b as Be,L as P,M as de,c as Ee}from"./index-1835bbd2.js";import{P as Pe}from"./PageDesc-ba26b28a.js";import{H as $e}from"./Helmet-6d870ae7.js";import{S as Ze}from"./SoundOutlined-5552bf53.js";const Oe=async c=>{try{return(await me.get(c)).data}catch(r){throw console.error("Fetch error:",r),r}},He=async([c,r])=>{try{return(await me.post(c,r)).data}catch(d){throw console.error("Fetch error:",d),d}},Ye=(c,r,d)=>{const{data:u,error:o,mutate:h}=pe(`/iblog/message/list?page=${c}&&pageSize=${r}&&auditStatus=${d}`,Oe,{revalidateOnFocus:!0});return{messageBoardList:u,isMessageBoradListFetched:!o&&u!==void 0,mutate:h}},qe=c=>{const{data:r,error:d}=pe(c?["/iblog/message/insert",c]:null,He);return{addMessageBoard:r,isAddMessageBoradFetched:!d&&r!==void 0}},Xe=()=>{const[c,r]=l.useState([]),[d,u]=l.useState(null),[o,h]=l.useState({_id:"",pid:"-1"}),[$,Z]=l.useState(1),[O,ue]=l.useState(10),[C,he]=l.useState(1),[ge]=l.useState("cm"),[b]=i.useForm(),[k]=i.useForm(),w=l.useRef(null),[fe,M]=l.useState(null),[g,H]=l.useState(),[z,Y]=l.useState(!1),[T,q]=l.useState(!1);F.extend(je);const j=se.useRef(null),D=se.useRef(null),[L,V]=l.useState(""),[I,U]=l.useState("");l.useEffect(()=>{j.current&&window.scroll({top:j.current.offsetTop-80||0,left:0,behavior:"smooth"})},[]),l.useEffect(()=>{if(localStorage.getItem("zhj")==="success"&&localStorage.getItem("yychuiyan")!==null){const n=_e(localStorage.getItem("yychuiyan"));H(n)}else H(null)},[]);const{messageBoardList:p,isMessageBoradListFetched:R,mutate:W}=Ye($,O,1),J=R&&p&&p.data?p.data:"";l.useEffect(()=>{R&&r(p.data.data)},[R,p,J]);const{totalCount:ye}=J,{addMessageBoard:S,isAddMessageBoradFetched:K}=qe(d),_=R&&p&&p.data?p.data.data:"";_&&_.forEach(t=>t.children.sort((n,m)=>{n.messageTime-m.messageTime}));const{sendEmail:xe,isSendEmailFetched:Q}=Le(fe);l.useEffect(()=>{Q&&console.log("")},[xe,Q]),l.useEffect(()=>{if(K)if(S.res&&S.res.pid==="-1")r(t=>[S.res,...t]);else{const t=_&&_.find(n=>n._id===S.res.pid);t?(t.children.push(S.res),console.log("找到父留言：",t)):console.error("未找到对应的留言"),r(n=>[t,...n])}},[K]);const be=async t=>{if(t.content===void 0||t.content==="")return x.warning("留言不能为空哦！");try{u({pid:o.pid,targetReplayId:o._id||"-1",targetReplayContent:"",currentReplayContent:t.content,auditTime:0,auditStatus:"1",avatar:g&&g.avatar,email:t.email,nickName:t.nickname});const n="haoju.zhang@outlook.com",m=`您的博客收到来自${t.nickname}<${t.email}>的留言`,s=`<div><br /><p>您在<span style="color: cadetblue; padding: 3px">夜雨炊烟</span>博客上收到新的留言</p><hr /><span style="color: cadetblue;">${t.nickname}:</span><p style="width: 98%;min-height: 30px;padding-top: 10px;padding-left: 10px;padding-bottom: 10px;background-color: #f5f5f5;border-radius: 10px;"><span>${t.content}</span></p><p><a href="https://yychuiyan.com/message"target="_blank"style="text-decoration: none; color: #5c8fef">点击查看详情</a></p></div>`.split(`
`).join(`
<br/>
`);M({email:n,subject:m,html:s}),setTimeout(()=>{x.success("留言成功！"),Z(1),C===1&&k.resetFields(),C===2&&(h({_id:"",pid:"-1"}),b.resetFields()),u(null),M(null),W()},500)}catch{x.error("留言失败，请重试！")}},G=()=>{},X=t=>{h(t),b.resetFields(),w&&setTimeout(()=>{var n;(n=w==null?void 0:w.current)==null||n.scrollIntoView({behavior:"smooth",block:"center",inline:"center"})},100)},we=t=>{if(t.content===void 0||t.content==="")return x.warning("回复内容不能为空哦！");he(2);const n={pid:o.pid==="-1"?o._id:o.pid,targetReplayId:o._id||"-1",targetReplayContent:`${t==null?void 0:t.nickname}@${o==null?void 0:o.nickName} ${o==null?void 0:o.currentReplayContent}`,currentReplayContent:t.content,auditTime:0,auditStatus:"1",avatar:g&&g.avatar,email:t.email,nickName:t.nickname};u(n),setTimeout(()=>{x.success("回复成功！"),C===1&&k.resetFields(),C===2&&(h({_id:"",pid:"-1"}),b.resetFields());const m=o.email,N="您在夜雨炊烟小站中的留言收到了回复",A=`<div><br /><p>您在<span style="color: cadetblue; padding: 3px">夜雨炊烟</span>博客中的留言：</p><hr /><p style="width: 98%;min-height: 30px;padding-top: 10px;padding-left: 10px;padding-bottom: 10px;background-color: #f5f5f5;border-radius: 10px;"><span>${o.currentReplayContent}</span></p>收到<span style="color: cadetblue; padding-right:2px;">${t.nickname}</span>的回复:<p style="width: 98%;min-height: 30px;padding-top: 10px;padding-left: 10px;padding-bottom: 10px;background-color: #f5f5f5;border-radius: 10px;"><span>${t.content}</span></p><p><a href="https://yychuiyan.com/message"target="_blank"style="text-decoration: none; color: #5c8fef">点击查看详情</a></p></div>`.split(`
`).join(`
<br/>
`);M({email:m,subject:N,html:A}),W()},500),ee()},ee=()=>{h({_id:"",pid:"-1"})},Se=(t,n)=>{Z(t),ue(n),window.scroll({top:D.current.offsetTop+180||0,left:0,behavior:"smooth"})},Ne=t=>{k.setFieldsValue({content:L.concat(t)}),V(L.concat(t)),Y(!z)},ve=t=>{V(t.target.value)},Ce=t=>{b.setFieldsValue({content:I.concat(t)}),U(I.concat(t)),q(!T)},ke=t=>{U(t.target.value)},Re=`name: 夜雨炊烟
link: https://yychuiyan.com
avatar: https://op.yychuiyan.com/avatar.webp
desc: 三餐烟火暖，四季皆安然。`;return a("div",{className:"w-1200 mx-auto pb-5 lg:w-full lg:mx-5 sm:w-[calc(100%-40px)]",ref:j,children:[e($e,{children:e("title",{children:"留言板 | 夜雨炊烟"})}),e(Pe,{title:"留言板"}),e("div",{className:"w-1000 mx-auto mt-10 lg:w-full",children:a(Ie,{className:" rounded-2xl bg-base-100",children:[e("div",{style:{textAlign:"center",fontSize:"16px",fontWeight:"bolder",marginBottom:"24px",position:"relative"},className:"lg:w-full sm:w-full",children:e("div",{className:"h-36 px-20 mt-5 font-normal lg:px-0 lg:mt-1",children:a("div",{className:"flex flex-col items-start w-[100%]  absolute",children:[e("p",{className:"flex absolute text-xl",style:{userSelect:"none"},children:"本站信息:"}),a("div",{className:"flex items-start relative justify-center flex-col w-800 mt-8 bg-base-200  rounded-xl hover:transition hover:duration-500 hover:shadow cursor-pointer lg:w-full",style:{userSelect:"none"},children:[e("p",{className:"absolute right-2 top-2",onClick:()=>{navigator.clipboard.writeText(Re),x.info({content:"复制成功!",icon:e(Ze,{style:{color:"var(--bgcolor-social-default)"}}),className:"text-[var(--bgcolor-social-default)]"})},children:e(Fe,{icon:Me,size:"xl"})}),a("p",{className:"pl-2 py-1",children:[e("span",{children:"name: "}),e("span",{children:"夜雨炊烟"})]}),a("p",{className:"pl-2 pb-1",children:[e("span",{children:"link: "}),e("span",{children:"https://yychuiyan.com"})]}),a("p",{className:"pl-2 pb-1 lg:flex lg:flex-col lg:items-start",children:[e("span",{children:"avatar: "}),e("span",{children:"https://op.yychuiyan.com/avatar.webp"})]}),a("p",{className:"pl-2 pb-1",children:[e("span",{children:"desc: "}),e("span",{children:"三餐烟火暖，四季皆安然。"})]})]})]})})}),a(i,{name:"basic",form:k,onFinish:be,onFinishFailed:G,className:"w-800 mx-auto  lg:w-full sm:w-full",children:[a(B,{children:[e(v,{span:12,className:"pr-2 mt-5 lg:mt-8",children:e(i.Item,{label:"",name:"nickname",rules:[{required:!0,message:"请输入你的昵称"},{whitespace:!0,message:"输入不能为空"},{min:2,message:"昵称不能小于2个字符"},{max:30,message:"主题不能大于30个字符"}],children:e(f,{maxLength:30,placeholder:"请输入你的昵称"})})}),e(v,{span:12,className:"pl-2 mt-5 lg:mt-8",children:e(i.Item,{label:"",name:"email",rules:[{required:!0,message:"请输入你的邮箱"},{pattern:/^[a-zA-Z0-9_.-]+@[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*\.[a-zA-Z0-9]{2,6}$/,message:"邮箱格式不正确"}],children:e(f,{maxLength:30,placeholder:"请输入你的邮箱"})})})]}),e(i.Item,{label:"",name:"content",children:e(f.TextArea,{placeholder:"请输入留言内容",onChange:ve,value:L,autoSize:{minRows:6,maxRows:12}})}),e(le,{overlayStyle:{width:"280px"},placement:"top",open:z,onOpenChange:()=>Y(!z),content:ie.map(t=>e("span",{className:"inline-block cursor-pointer px-2 text-[20px] hover:bg-blue-400 w-5 h-8 rounded-md",onClick:()=>Ne(t.emoji),children:t.emoji},t.id)),children:a("div",{className:"-mt-5 mb-1 flex items-center justify-center w-16 h-8 text-center rounded cursor-pointer border-1 border-solid border-base-200",style:{userSelect:"none"},children:[e("span",{children:e(oe,{iconName:"icon-biaoqing",className:"text-[20px] text-[var(--color-icon-default)] pr-1"})}),e("span",{className:"text-[var(--color-icon-default)]",style:{userSelect:"none"},children:"表情"})]})}),e(i.Item,{className:"",children:a(E,{type:"primary",htmlType:"submit",className:"w-800 mx-auto lg:w-full sm:w-full",children:[e(Ae,{})," 提交留言"]})})]}),e(B,{className:"mt:h-4 w-full mx-auto lg:w-full sm:w-full",ref:D,children:a(v,{span:24,className:"sm:w-full lg:w-full",children:[a("b",{style:{marginBottom:"24px",color:"var(--color-icon-default)",userSelect:"none"},children:["留言展示 ",e(Be,{})]}),c&&c.length>0?e(P,{itemLayout:"horizontal",className:"sm:w-full lg:w-full",dataSource:c&&c,renderItem:(t,n)=>{var m,N;return e(P.Item,{actions:[],children:e(P.Item.Meta,{avatar:t.nickName.trim()==="夜雨炊烟"?e(y,{style:{userSelect:"none"},src:ce}):t.avatar?e(y,{style:{userSelect:"none"},src:t.avatar}):e(y,{style:{backgroundColor:"#1890ff",userSelect:"none"},children:(N=(m=t.nickName)==null?void 0:m.slice(0,1))==null?void 0:N.toUpperCase()}),title:e("b",{style:{color:"var(--color-icon-default)",userSelect:"none"},children:t.nickName}),description:a(re,{children:[e("div",{className:"user_content font-normal lg:w-full",children:e("pre",{className:"lg:overflow-auto",dangerouslySetInnerHTML:{__html:t.currentReplayContent.replace(/((http|https):\/\/[-A-Za-z0-9+&@#/%?=~_|!:,.;]+[-A-Za-z0-9+&@#/%=~_|])/g,s=>"<a href='"+s+"' target='_blank'>"+s+"</a>")}})}),a("div",{className:"sm:w-full lg:w-full",style:{fontSize:"12px",marginTop:"8px",marginBottom:"16px",alignItems:"center",display:"flex",flexWrap:"wrap",justifyContent:"space-between"},children:[a("span",{className:"user_desc",style:{userSelect:"none"},children:["用户 ",t.nickName,"  发表于 ",F(t.messageTime*1e3).format("YYYY-MM-DD HH:mm:ss")]}),e("span",{style:{userSelect:"none"},children:a("a",{style:{fontSize:"12px",marginRight:"12px"},onClick:()=>X(t),children:[e(de,{}),"  回复"]})})]}),t.children&&t.children.length?e(re,{children:t.children.map((s,A)=>{var te,ae;return e(Ee,{className:"bg-base-100",author:e("span",{className:"replay_title",style:{userSelect:"none"},children:s.targetReplayContent.substring(0,40)+"···"}),avatar:s.nickName.trim()==="夜雨炊烟"?e(y,{style:{userSelect:"none"},src:ce}):s.avatar?e(y,{style:{userSelect:"none"},src:s.avatar}):e(y,{style:{backgroundColor:"#1890ff",userSelect:"none"},children:(ae=(te=s.nickName)==null?void 0:te.slice(0,1))==null?void 0:ae.toUpperCase()}),content:e("span",{className:"user_content font-normal",children:e("pre",{className:"lg:overflow-auto",dangerouslySetInnerHTML:{__html:s.currentReplayContent.replace(/((http|https):\/\/[-A-Za-z0-9+&@#/%?=~_|!:,.;]+[-A-Za-z0-9+&@#/%=~_|])/g,ne=>"<a href='"+ne+"' target='_blank'>"+ne+"</a>")}})}),datetime:e(ze,{title:s.messageTime,children:e("span",{style:{userSelect:"none"},children:F(F(s.messageTime*1e3).format("YYYY-MM-DD HH:mm:ss")).fromNow()})}),actions:[a("a",{style:{fontSize:"12px",marginRight:"12px",userSelect:"none"},onClick:()=>X(s),children:[e(de,{}),"  回复"]})]},A)})}):null,o._id===t._id||o.pid===t._id?e("div",{style:{marginTop:"12px"},ref:w,children:a(i,{form:b,name:"reply",onFinish:we,onFinishFailed:G,children:[a(B,{children:[e(v,{span:12,className:"pr-2",children:e(i.Item,{label:"",name:"nickname",rules:[{required:!0,message:"请输入你的昵称"},{whitespace:!0,message:"输入不能为空"},{min:2,message:"昵称不能小于2个字符"},{max:30,message:"主题不能大于30个字符"}],children:e(f,{maxLength:30,placeholder:"请输入你的昵称"})})}),e(v,{span:12,className:"pl-2",children:e(i.Item,{label:"",name:"email",rules:[{required:!0,message:"请输入你的邮箱"},{pattern:/^[a-zA-Z0-9_.-]+@[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*\.[a-zA-Z0-9]{2,6}$/,message:"邮箱格式不正确"}],children:e(f,{maxLength:30,placeholder:"请输入你的邮箱"})})})]}),e(i.Item,{label:"",name:"content",children:e(f.TextArea,{placeholder:"请输入回复内容",onChange:ke,value:I,autoSize:{minRows:6,maxRows:12}})}),e(le,{overlayStyle:{width:"280px"},placement:"top",open:T,onOpenChange:()=>q(!T),content:ie.map(s=>e("span",{className:" inline-block cursor-pointer px-2 text-[20px] hover:bg-blue-400 w-5 h-8 rounded-md",onClick:()=>Ce(s.emoji),children:s.emoji},s.id)),children:a("div",{className:"-mt-5 mb-1 flex items-center justify-center w-16 h-8 text-center rounded cursor-pointer border-1 border-solid border-base-200",style:{userSelect:"none"},children:[e("span",{children:e(oe,{iconName:"icon-biaoqing",className:"text-[20px] text-[var(--color-icon-default)] pr-1"})}),e("span",{className:"text-[var(--color-icon-default)]",children:"表情"})]})}),e(i.Item,{children:a("div",{style:{display:"flex",justifyContent:"flex-end"},children:[e(E,{style:{marginRight:"12px"},onClick:()=>ee(),children:"取消"}),e(E,{type:"primary",htmlType:"submit",children:" 回复"})]})}),e(i.Item,{})]})}):null]})})},n)}}):e("div",{className:"flex justify-center",children:"暂无留言~"}),e(Te,{text:ge,pageSize:O,currentPage:$,total:ye,onChange:Se})]})})]})})]})};export{Xe as default};
