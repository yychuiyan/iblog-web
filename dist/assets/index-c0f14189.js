import{s as pe,w as he,o,aF as i,R as ge,t as ue,p as t,q as e,aG as fe,aH as ye,aI as E,aJ as A,aK as b,aL as J,aM as Z,aN as w,aO as K,T as xe,v as be,u as M,B as we}from"./index-a23d7047.js";import{a as Q,M as Se}from"./index-a4d2d2b7.js";import{d as h}from"./dayjs.min-f3c6d1ba.js";import{r as Ce,C as ve,e as X,a as Ne,b as ze,L as $,M as ee,c as ke}from"./emoji-4e24262c.js";import{P as Ae}from"./PageDesc-b270e228.js";import{S as Me}from"./SoundOutlined-827c6567.js";const Te=r=>{const[P,T]=o.useState([]),[s,S]=o.useState({_id:"",pid:"-1"}),[ae,R]=o.useState(0),[C,_]=o.useState(1),[v,j]=o.useState(10),[Y,te]=o.useState(1),[ne,_e]=o.useState("cm"),[N]=i.useForm(),[B]=i.useForm(),z=o.useRef(null);let[u,O]=o.useState();const[f,I]=o.useState(!1);h.extend(Ce);const F=ge.useRef(),[H,q]=o.useState(""),[L,V]=o.useState("");o.useEffect(()=>{F.current&&window.scroll({top:F.current.offsetTop-80||0,left:0,behavior:"smooth"})},[]),o.useEffect(()=>{if(localStorage.getItem("zhj")==="success"&&localStorage.getItem("yychuiyan")!==null){const l=ue(localStorage.getItem("yychuiyan"));O(l)}else O(null)},[localStorage]),o.useEffect(()=>{r.BlogActions.asyncMessageListAction(C,v,1).then(a=>{let{data:l,totalCount:d,page:p,pageSize:n}=a.data;l.map(m=>{m.messageTime=h(m.messageTime*1e3).format("YYYY-MM-DD HH:mm:ss"),m.children.map(c=>{c.messageTime=h(c.messageTime*1e3).format("YYYY-MM-DD HH:mm:ss")})}),T(l),R(d),_(p),j(n)})},[C,v,r.BlogActions]);const se=a=>{if(a.content===void 0||a.content==="")return M.warning("留言内容不能为空😯");r.BlogActions.asyncMessageInsertAction({pid:s.pid,targetReplayId:s._id||"-1",targetReplayContent:"",currentReplayContent:a.content,auditTime:0,auditStatus:"1",avatar:Boolean(u)?u.avatar:u,email:a.email,nickName:a.nickname}).then(()=>{setTimeout(()=>{M.success("留言成功~"),Y===1&&B.resetFields(),Y===2&&(S({_id:"",pid:"-1"}),N.resetFields()),r.BlogActions.asyncMessageListAction(C,v,1).then(m=>{let{data:c,totalCount:y,page:x,pageSize:D}=m.data;c.map(g=>{g.messageTime=h(g.messageTime*1e3).format("YYYY-MM-DD HH:mm:ss"),g.children.map(k=>{k.messageTime=h(k.messageTime*1e3).format("YYYY-MM-DD HH:mm:ss")})}),T(c),R(y),_(x),j(D)});let l="haoju.zhang@outlook.com",d=`您的博客收到来自${a.nickname}<${a.email}>的留言`,n=`<div><br /><p>您在<span style="color: cadetblue; padding: 3px">夜雨炊烟</span>博客上收到新的留言</p><hr /><span style="color: cadetblue;">${a.nickname}:</span><p style="width: 98%;min-height: 30px;padding-top: 10px;padding-left: 10px;padding-bottom: 10px;background-color: #f5f5f5;border-radius: 10px;"><span>${a.content}</span></p><p><a href="https://yychuiyan.com/rblog/message"target="_blank"style="text-decoration: none; color: #5c8fef">点击查看详情</a></p></div>`.split(`
`).join(`
<br/>
`);r.BlogActions.asyncSendMailAction({email:l,subject:d,html:n})},500)})},U=()=>{},W=a=>{S(a),N.resetFields(),z&&setTimeout(()=>{var l;(l=z==null?void 0:z.current)==null||l.scrollIntoView({behavior:"smooth",block:"center",inline:"center"})},100)},le=a=>{if(a.content===void 0||a.content==="")return M.warning("回复内容不能为空😯");te(2),r.BlogActions.asyncMessageInsertAction({pid:s.pid==="-1"?s._id:s.pid,targetReplayId:s._id||"-1",targetReplayContent:`${a==null?void 0:a.nickname}@${s==null?void 0:s.nickName} ${s==null?void 0:s.currentReplayContent}`,currentReplayContent:a.content,auditTime:0,auditStatus:"1",avatar:Boolean(u)?u.avatar:u,email:a.email,nickName:a.nickname}).then(()=>{setTimeout(()=>{M.success("回复成功~"),Y===1&&B.resetFields(),Y===2&&(S({_id:"",pid:"-1"}),N.resetFields()),r.BlogActions.asyncMessageListAction(C,v,1).then(m=>{let{data:c,totalCount:y,page:x,pageSize:D}=m.data;c.map(g=>{g.messageTime=h(g.messageTime*1e3).format("YYYY-MM-DD HH:mm:ss"),g.children.map(k=>{k.messageTime=h(k.messageTime*1e3).format("YYYY-MM-DD HH:mm:ss")})}),T(c),S(c),R(y),_(x),j(D)});let l=s.email,d="您在夜雨炊烟小站中的留言收到了回复",n=`<div><br /><p>您在<span style="color: cadetblue; padding: 3px">夜雨炊烟</span>博客中的留言：</p><hr /><p style="width: 98%;min-height: 30px;padding-top: 10px;padding-left: 10px;padding-bottom: 10px;background-color: #f5f5f5;border-radius: 10px;"><span>${s.currentReplayContent}</span></p>收到<span style="color: cadetblue; padding-right:2px;">${a.nickname}</span>的回复:<p style="width: 98%;min-height: 30px;padding-top: 10px;padding-left: 10px;padding-bottom: 10px;background-color: #f5f5f5;border-radius: 10px;"><span>${a.content}</span></p><p><a href="https://yychuiyan.com/rblog/message"target="_blank"style="text-decoration: none; color: #5c8fef">点击查看详情</a></p></div>`.split(`
`).join(`
<br/>
`);r.BlogActions.asyncSendMailAction({email:l,subject:d,html:n})},500)}),G()},G=()=>{S({_id:"",pid:"-1"})},oe=(a,l)=>{r.BlogActions.asyncArticleCommentsAction(a,l,1).then(d=>{let{data:p,totalCount:n,page:m,pageSize:c}=d.data;T(p),R(n),_(m),j(c)})},ce=a=>{B.setFieldsValue({content:H.concat(a)}),q(H.concat(a)),I(!f)},ie=a=>{q(a.target.value)},re=a=>{N.setFieldsValue({content:L.concat(a)}),V(L.concat(a)),I(!f)},me=a=>{V(a.target.value)},de=`name: 夜雨炊烟
link: https://yychuiyan.com
avatar: https://op.yychuiyan.com/avatar.webp
desc: 三餐烟火暖，四季皆安然。`;return t("div",{className:"w-1200 mx-auto pb-5 lg:w-full lg:mx-5 sm:w-full",ref:F,children:[e(Ae,{title:"留言板"}),e("div",{className:"w-1000 mx-auto mt-10 lg:w-full sm:w-full",children:t(ve,{className:" rounded-2xl bg-base-100",children:[e("div",{style:{textAlign:"center",fontSize:"16px",fontWeight:"bolder",marginBottom:"24px",position:"relative"},className:"lg:w-full sm:w-full",children:e("div",{className:"h-36 px-20 mt-5 font-normal lg:px-0",children:t("div",{className:"flex flex-col items-start w-[100%]  absolute",children:[e("p",{className:"flex absolute text-xl",style:{userSelect:"none"},children:"本站信息:"}),t("div",{className:"flex items-start relative justify-center flex-col w-800 mt-8 bg-base-200  rounded-xl hover:transition hover:duration-500 hover:shadow cursor-pointer lg:w-full",style:{userSelect:"none"},children:[e("p",{className:"absolute right-2 top-2",onClick:()=>{navigator.clipboard.writeText(de),M.info({content:"复制成功!",icon:e(Me,{style:{color:"var(--bgcolor-social-default)"}}),className:"text-[var(--bgcolor-social-default)]"})},children:e(fe,{icon:ye,size:"xl"})}),t("p",{className:"pl-2 py-1",children:[e("span",{children:"name: "}),e("span",{children:"夜雨炊烟"})]}),t("p",{className:"pl-2 pb-1",children:[e("span",{children:"link: "}),e("span",{children:"https://yychuiyan.com"})]}),t("p",{className:"pl-2 pb-1 lg:flex lg:flex-col lg:items-start",children:[e("span",{children:"avatar: "}),e("span",{children:"https://op.yychuiyan.com/avatar.webp"})]}),t("p",{className:"pl-2 pb-1",children:[e("span",{children:"desc: "}),e("span",{children:"三餐烟火暖，四季皆安然。"})]})]})]})})}),t(i,{name:"basic",form:B,onFinish:se,onFinishFailed:U,className:"w-800 mx-auto  lg:w-full sm:w-full",children:[t(E,{children:[e(A,{span:12,className:"pr-2 mt-5 lg:mt-8",children:e(i.Item,{label:"",name:"nickname",rules:[{required:!0,message:"请输入你的昵称"},{whitespace:!0,message:"输入不能为空"},{min:2,message:"昵称不能小于2个字符"},{max:30,message:"主题不能大于30个字符"}],children:e(b,{maxLength:30,placeholder:"请输入你的昵称"})})}),e(A,{span:12,className:"pl-2 mt-5 lg:mt-8",children:e(i.Item,{label:"",name:"email",rules:[{required:!0,message:"请输入邮箱"},{pattern:/^[a-zA-Z0-9_.-]+@[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*\.[a-zA-Z0-9]{2,6}$/,message:"邮箱格式不正确"}],children:e(b,{maxLength:30,placeholder:"请输入你的邮箱"})})})]}),e(i.Item,{label:"",name:"content",children:e(b.TextArea,{placeholder:"请输入留言内容",onChange:ie,value:H,autoSize:{minRows:6,maxRows:12}})}),e(J,{overlayStyle:{width:"260px"},placement:"top",open:f,onOpenChange:()=>I(!f),content:X.map(a=>e("span",{className:" inline-block cursor-pointer px-2 text-[20px] hover:bg-blue-400 w-5 h-8 rounded-md",onClick:()=>ce(a.emoji),children:a.emoji},a.id)),children:t("div",{className:"-mt-5 mb-1 flex items-center justify-center w-16 h-8 text-center rounded cursor-pointer border-1 border-solid border-base-200",style:{userSelect:"none"},children:[e("span",{children:t("svg",{className:"icon w-6 h-6 pt-1",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"2554",children:[e("path",{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64z m0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z",fill:"#333333","p-id":"2555"}),e("path",{d:"M512 140c-205.4 0-372 166.6-372 372s166.6 372 372 372 372-166.6 372-372-166.6-372-372-372zM288 421a48.01 48.01 0 0 1 96 0 48.01 48.01 0 0 1-96 0z m224 272c-85.5 0-155.6-67.3-160-151.6a8 8 0 0 1 8-8.4h48.1c4.2 0 7.8 3.2 8.1 7.4C420 589.9 461.5 629 512 629s92.1-39.1 95.8-88.6c0.3-4.2 3.9-7.4 8.1-7.4H664a8 8 0 0 1 8 8.4C667.6 625.7 597.5 693 512 693z m176-224a48.01 48.01 0 0 1 0-96 48.01 48.01 0 0 1 0 96z",fill:"#E6E6E6","p-id":"2556"}),e("path",{d:"M288 421a48 48 0 1 0 96 0 48 48 0 1 0-96 0z m376 112h-48.1c-4.2 0-7.8 3.2-8.1 7.4-3.7 49.5-45.3 88.6-95.8 88.6s-92-39.1-95.8-88.6c-0.3-4.2-3.9-7.4-8.1-7.4H360a8 8 0 0 0-8 8.4c4.4 84.3 74.5 151.6 160 151.6s155.6-67.3 160-151.6a8 8 0 0 0-8-8.4z m-24-112a48 48 0 1 0 96 0 48 48 0 1 0-96 0z",fill:"#333333","p-id":"2557"})]})}),e("span",{className:"text-base text-[var(--bgcolor-navbar-click)]",style:{userSelect:"none"},children:"表情"})]})}),e(i.Item,{className:"",children:t(Z,{type:"primary",htmlType:"submit",className:"w-800 mx-auto lg:w-full sm:w-full",children:[e(Ne,{})," 提交留言"]})})]}),e(E,{className:"mt:h-4 w-full mx-auto lg:w-full sm:w-full",children:t(A,{span:24,className:"sm:w-full lg:w-full",children:[t("b",{style:{marginBottom:"24px",color:"var(--color-icon-default)",userSelect:"none"},children:["留言展示 ",e(ze,{})]}),P.length>0?e($,{itemLayout:"horizontal",className:"sm:w-full lg:w-full",dataSource:P,renderItem:(a,l)=>{var d,p;return e($.Item,{actions:[],children:e($.Item.Meta,{avatar:a.nickName.trim()==="夜雨炊烟"?e(w,{style:{userSelect:"none"},src:Q}):Boolean(a.avatar)?e(w,{style:{userSelect:"none"},src:a.avatar}):e(w,{style:{backgroundColor:"#1890ff",userSelect:"none"},children:(p=(d=a.nickName)==null?void 0:d.slice(0,1))==null?void 0:p.toUpperCase()}),title:e("b",{style:{color:"var(--color-icon-default)",userSelect:"none"},children:a.nickName}),description:t(K,{children:[e("div",{className:"user_content font-normal lg:w-full",children:e("pre",{className:"lg:overflow-auto",dangerouslySetInnerHTML:{__html:a.currentReplayContent.replace(/((http|https):\/\/[-A-Za-z0-9+&@#/%?=~_|!:,.;]+[-A-Za-z0-9+&@#/%=~_|])/g,n=>"<a href='"+n+"' target='_blank'>"+n+"</a>")}})}),t("div",{className:"sm:w-full lg:w-full",style:{fontSize:"12px",marginTop:"8px",marginBottom:"16px",alignItems:"center",display:"flex",flexWrap:"wrap",justifyContent:"space-between"},children:[t("span",{className:"user_desc",style:{userSelect:"none"},children:["用户 ",a.nickName,"  发表于 ",a.messageTime]}),e("span",{style:{userSelect:"none"},children:t("a",{style:{fontSize:"12px",marginRight:"12px"},onClick:()=>W(a),children:[e(ee,{}),"  回复"]})})]}),a.children&&a.children.length?e(K,{children:a.children.map((n,m)=>{var c,y;return e(ke,{className:"bg-base-100",author:e("span",{className:"replay_title",style:{userSelect:"none"},children:n.targetReplayContent.substring(0,40)+"···"}),avatar:n.nickName.trim()==="夜雨炊烟"?e(w,{style:{userSelect:"none"},src:Q}):Boolean(n.avatar)?e(w,{style:{userSelect:"none"},src:n.avatar}):e(w,{style:{backgroundColor:"#1890ff",userSelect:"none"},children:(y=(c=n.nickName)==null?void 0:c.slice(0,1))==null?void 0:y.toUpperCase()}),content:e("span",{className:"user_content font-normal",children:e("pre",{className:"lg:overflow-auto",dangerouslySetInnerHTML:{__html:n.currentReplayContent.replace(/((http|https):\/\/[-A-Za-z0-9+&@#/%?=~_|!:,.;]+[-A-Za-z0-9+&@#/%=~_|])/g,x=>"<a href='"+x+"' target='_blank'>"+x+"</a>")}})}),datetime:e(xe,{title:n.messageTime,children:e("span",{style:{userSelect:"none"},children:h(n.messageTime).fromNow()})}),actions:[t("a",{style:{fontSize:"12px",marginRight:"12px",userSelect:"none"},onClick:()=>W(n),children:[e(ee,{}),"  回复"]})]},m)})}):null,s._id===a._id||s.pid===a._id?e("div",{style:{marginTop:"12px"},ref:z,children:t(i,{form:N,name:"reply",onFinish:le,onFinishFailed:U,children:[t(E,{children:[e(A,{span:12,className:"pr-2",children:e(i.Item,{label:"",name:"nickname",rules:[{required:!0,message:"请输入你的昵称"},{whitespace:!0,message:"输入不能为空"},{min:2,message:"昵称不能小于2个字符"},{max:30,message:"主题不能大于30个字符"}],children:e(b,{maxLength:30,placeholder:"请输入你的昵称"})})}),e(A,{span:12,className:"pl-2",children:e(i.Item,{label:"",name:"email",rules:[{required:!0,message:"请输入邮箱"},{pattern:/^[a-zA-Z0-9_.-]+@[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*\.[a-zA-Z0-9]{2,6}$/,message:"邮箱格式不正确"}],children:e(b,{maxLength:30,placeholder:"请输入你的邮箱"})})})]}),e(i.Item,{label:"",name:"content",children:e(b.TextArea,{placeholder:"请输入回复内容",onChange:me,value:L,autoSize:{minRows:6,maxRows:12}})}),e(J,{overlayStyle:{width:"260px"},placement:"top",open:f,onOpenChange:()=>I(!f),content:X.map(n=>e("span",{className:" inline-block cursor-pointer px-2 text-[20px] hover:bg-blue-400 w-5 h-8 rounded-md",onClick:()=>re(n.emoji),children:n.emoji},n.id)),children:t("div",{className:"-mt-5 mb-1 flex items-center justify-center w-16 h-8 text-center rounded cursor-pointer border-1 border-solid border-base-200",style:{userSelect:"none"},children:[e("span",{children:t("svg",{className:"icon w-6 h-6 pt-1",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"2554",children:[e("path",{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64z m0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z",fill:"#333333","p-id":"2555"}),e("path",{d:"M512 140c-205.4 0-372 166.6-372 372s166.6 372 372 372 372-166.6 372-372-166.6-372-372-372zM288 421a48.01 48.01 0 0 1 96 0 48.01 48.01 0 0 1-96 0z m224 272c-85.5 0-155.6-67.3-160-151.6a8 8 0 0 1 8-8.4h48.1c4.2 0 7.8 3.2 8.1 7.4C420 589.9 461.5 629 512 629s92.1-39.1 95.8-88.6c0.3-4.2 3.9-7.4 8.1-7.4H664a8 8 0 0 1 8 8.4C667.6 625.7 597.5 693 512 693z m176-224a48.01 48.01 0 0 1 0-96 48.01 48.01 0 0 1 0 96z",fill:"#E6E6E6","p-id":"2556"}),e("path",{d:"M288 421a48 48 0 1 0 96 0 48 48 0 1 0-96 0z m376 112h-48.1c-4.2 0-7.8 3.2-8.1 7.4-3.7 49.5-45.3 88.6-95.8 88.6s-92-39.1-95.8-88.6c-0.3-4.2-3.9-7.4-8.1-7.4H360a8 8 0 0 0-8 8.4c4.4 84.3 74.5 151.6 160 151.6s155.6-67.3 160-151.6a8 8 0 0 0-8-8.4z m-24-112a48 48 0 1 0 96 0 48 48 0 1 0-96 0z",fill:"#333333","p-id":"2557"})]})}),e("span",{className:"text-base text-[var(--bgcolor-navbar-click)]",children:"表情"})]})}),e(i.Item,{children:t("div",{style:{display:"flex",justifyContent:"flex-end"},children:[e(Z,{style:{marginRight:"12px"},onClick:()=>G(),children:"取消"}),e(Z,{type:"primary",htmlType:"submit",children:" 回复"})]})}),e(i.Item,{})]})}):null]})})},l)}}):e("div",{className:"flex justify-center",children:"暂无留言~"}),e(Se,{text:ne,pageSize:v,currentPage:C,total:ae,onChange:oe})]})})]})})]})},Re=r=>({BlogActions:be(we,r)}),De=pe(null,Re)(he(Te));export{De as default};
