import{B as de,D as pe,p as o,J as i,R as se,w as Re,t as a,v as e,K as _e,L as Fe,M as B,N as v,O as f,P as oe,I as le,Q as E,S as y,T as re,U as Me,z as x}from"./index-b486f2d2.js";import{M as ze}from"./index-e733a217.js";import{d as F}from"./dayjs.min-9e000d2f.js";import{r as Te,u as je,C as Le,e as ce,a as Ie,b as Ae,L as P,M as ie,c as Be}from"./index-976ac73e.js";import{P as Ee}from"./PageDesc-8b82097b.js";import{H as Pe}from"./Helmet-f675b0d6.js";import{S as $e}from"./SoundOutlined-9305e939.js";const Ze=async c=>{try{return(await pe.get(c)).data}catch(r){throw console.error("Fetch error:",r),r}},Oe=async([c,r])=>{try{return(await pe.post(c,r)).data}catch(d){throw console.error("Fetch error:",d),d}},He=(c,r,d)=>{const{data:u,error:l,mutate:h}=de(`/iblog/message/list?page=${c}&&pageSize=${r}&&auditStatus=${d}`,Ze,{revalidateOnFocus:!0});return{messageBoardList:u,isMessageBoradListFetched:!l&&u!==void 0,mutate:h}},Ye=c=>{const{data:r,error:d}=de(c?["/iblog/message/insert",c]:null,Oe);return{addMessageBoard:r,isAddMessageBoradFetched:!d&&r!==void 0}},Ge=()=>{const[c,r]=o.useState([]),[d,u]=o.useState(null),[l,h]=o.useState({_id:"",pid:"-1"}),[$,Z]=o.useState(1),[O,me]=o.useState(10),[C,ue]=o.useState(1),[he]=o.useState("cm"),[b]=i.useForm(),[k]=i.useForm(),w=o.useRef(null),[ge,M]=o.useState(null),[g,H]=o.useState(),[z,Y]=o.useState(!1),[T,q]=o.useState(!1);F.extend(Te);const j=se.useRef(null),D=se.useRef(null),[L,V]=o.useState(""),[I,U]=o.useState("");o.useEffect(()=>{j.current&&window.scroll({top:j.current.offsetTop-80||0,left:0,behavior:"smooth"})},[]),o.useEffect(()=>{if(localStorage.getItem("zhj")==="success"&&localStorage.getItem("yychuiyan")!==null){const n=Re(localStorage.getItem("yychuiyan"));H(n)}else H(null)},[]);const{messageBoardList:p,isMessageBoradListFetched:R,mutate:W}=He($,O,1),J=R&&p&&p.data?p.data:"";o.useEffect(()=>{R&&r(p.data.data)},[R,p,J]);const{totalCount:fe}=J,{addMessageBoard:S,isAddMessageBoradFetched:K}=Ye(d),_=R&&p&&p.data?p.data.data:"";_&&_.forEach(t=>t.children.sort((n,m)=>{n.messageTime-m.messageTime}));const{sendEmail:ye,isSendEmailFetched:Q}=je(ge);o.useEffect(()=>{Q&&console.log("")},[ye,Q]),o.useEffect(()=>{if(K)if(S.res&&S.res.pid==="-1")r(t=>[S.res,...t]);else{const t=_&&_.find(n=>n._id===S.res.pid);t?(t.children.push(S.res),console.log("找到父留言：",t)):console.error("未找到对应的留言"),r(n=>[t,...n])}},[K]);const xe=async t=>{if(t.content===void 0||t.content==="")return x.warning("留言不能为空哦！");try{u({pid:l.pid,targetReplayId:l._id||"-1",targetReplayContent:"",currentReplayContent:t.content,auditTime:0,auditStatus:"1",avatar:g&&g.avatar,email:t.email,nickName:t.nickname});const n="haoju.zhang@outlook.com",m=`您的博客收到来自${t.nickname}<${t.email}>的留言`,s=`<div><br /><p>您在<span style="color: cadetblue; padding: 3px">夜雨炊烟</span>博客上收到新的留言</p><hr /><span style="color: cadetblue;">${t.nickname}:</span><p style="width: 98%;min-height: 30px;padding-top: 10px;padding-left: 10px;padding-bottom: 10px;background-color: #f5f5f5;border-radius: 10px;"><span>${t.content}</span></p><p><a href="https://yychuiyan.com/message"target="_blank"style="text-decoration: none; color: #5c8fef">点击查看详情</a></p></div>`.split(`
`).join(`
<br/>
`);M({email:n,subject:m,html:s}),setTimeout(()=>{x.success("留言成功！"),Z(1),C===1&&k.resetFields(),C===2&&(h({_id:"",pid:"-1"}),b.resetFields()),u(null),M(null),W()},500)}catch{x.error("留言失败，请重试！")}},G=()=>{},X=t=>{h(t),b.resetFields(),w&&setTimeout(()=>{var n;(n=w==null?void 0:w.current)==null||n.scrollIntoView({behavior:"smooth",block:"center",inline:"center"})},100)},be=t=>{if(t.content===void 0||t.content==="")return x.warning("回复内容不能为空哦！");ue(2);const n={pid:l.pid==="-1"?l._id:l.pid,targetReplayId:l._id||"-1",targetReplayContent:`${t==null?void 0:t.nickname}@${l==null?void 0:l.nickName} ${l==null?void 0:l.currentReplayContent}`,currentReplayContent:t.content,auditTime:0,auditStatus:"1",avatar:g&&g.avatar,email:t.email,nickName:t.nickname};u(n),setTimeout(()=>{x.success("回复成功！"),C===1&&k.resetFields(),C===2&&(h({_id:"",pid:"-1"}),b.resetFields());const m=l.email,N="您在夜雨炊烟小站中的留言收到了回复",A=`<div><br /><p>您在<span style="color: cadetblue; padding: 3px">夜雨炊烟</span>博客中的留言：</p><hr /><p style="width: 98%;min-height: 30px;padding-top: 10px;padding-left: 10px;padding-bottom: 10px;background-color: #f5f5f5;border-radius: 10px;"><span>${l.currentReplayContent}</span></p>收到<span style="color: cadetblue; padding-right:2px;">${t.nickname}</span>的回复:<p style="width: 98%;min-height: 30px;padding-top: 10px;padding-left: 10px;padding-bottom: 10px;background-color: #f5f5f5;border-radius: 10px;"><span>${t.content}</span></p><p><a href="https://yychuiyan.com/message"target="_blank"style="text-decoration: none; color: #5c8fef">点击查看详情</a></p></div>`.split(`
`).join(`
<br/>
`);M({email:m,subject:N,html:A}),W()},500),ee()},ee=()=>{h({_id:"",pid:"-1"})},we=(t,n)=>{Z(t),me(n),window.scroll({top:D.current.offsetTop+180||0,left:0,behavior:"smooth"})},Se=t=>{k.setFieldsValue({content:L.concat(t)}),V(L.concat(t)),Y(!z)},Ne=t=>{V(t.target.value)},ve=t=>{b.setFieldsValue({content:I.concat(t)}),U(I.concat(t)),q(!T)},Ce=t=>{U(t.target.value)},ke=`name: 夜雨炊烟
link: https://yychuiyan.com
avatar: https://op.yychuiyan.com/avatar.webp
desc: 三餐烟火暖，四季皆安然。`;return a("div",{className:"w-1200 mx-auto pb-5 lg:w-full lg:mx-5 sm:w-[calc(100%-40px)]",ref:j,children:[e(Pe,{children:e("title",{children:"留言板 | 夜雨炊烟"})}),e(Ee,{title:"留言板"}),e("div",{className:"w-1000 mx-auto mt-10 lg:w-full",children:a(Le,{className:" rounded-2xl bg-base-100",children:[e("div",{style:{textAlign:"center",fontSize:"16px",fontWeight:"bolder",marginBottom:"24px",position:"relative"},className:"lg:w-full sm:w-full",children:e("div",{className:"h-36 px-20 mt-5 font-normal lg:px-0 lg:mt-1",children:a("div",{className:"flex flex-col items-start w-[100%]  absolute",children:[e("p",{className:"flex absolute text-xl",style:{userSelect:"none"},children:"本站信息:"}),a("div",{className:"flex items-start relative justify-center flex-col w-800 mt-8 bg-base-200  rounded-xl hover:transition hover:duration-500 hover:shadow cursor-pointer lg:w-full",style:{userSelect:"none"},children:[e("p",{className:"absolute right-2 top-2",onClick:()=>{navigator.clipboard.writeText(ke),x.info({content:"复制成功!",icon:e($e,{style:{color:"var(--bgcolor-social-default)"}}),className:"text-[var(--bgcolor-social-default)]"})},children:e(_e,{icon:Fe,size:"xl"})}),a("p",{className:"pl-2 py-1",children:[e("span",{children:"name: "}),e("span",{children:"夜雨炊烟"})]}),a("p",{className:"pl-2 pb-1",children:[e("span",{children:"link: "}),e("span",{children:"https://yychuiyan.com"})]}),a("p",{className:"pl-2 pb-1 lg:flex lg:flex-col lg:items-start",children:[e("span",{children:"avatar: "}),e("span",{children:"https://op.yychuiyan.com/avatar.webp"})]}),a("p",{className:"pl-2 pb-1",children:[e("span",{children:"desc: "}),e("span",{children:"三餐烟火暖，四季皆安然。"})]})]})]})})}),a(i,{name:"basic",form:k,onFinish:xe,onFinishFailed:G,className:"w-800 mx-auto  lg:w-full sm:w-full",children:[a(B,{children:[e(v,{span:12,className:"pr-2 mt-5 lg:mt-8",children:e(i.Item,{label:"",name:"nickname",rules:[{required:!0,message:"请输入你的昵称"},{whitespace:!0,message:"输入不能为空"},{min:2,message:"昵称不能小于2个字符"},{max:30,message:"主题不能大于30个字符"}],children:e(f,{maxLength:30,placeholder:"请输入你的昵称"})})}),e(v,{span:12,className:"pl-2 mt-5 lg:mt-8",children:e(i.Item,{label:"",name:"email",rules:[{required:!0,message:"请输入你的邮箱"},{pattern:/^[a-zA-Z0-9_.-]+@[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*\.[a-zA-Z0-9]{2,6}$/,message:"邮箱格式不正确"}],children:e(f,{maxLength:30,placeholder:"请输入你的邮箱"})})})]}),e(i.Item,{label:"",name:"content",children:e(f.TextArea,{placeholder:"请输入留言内容",onChange:Ne,value:L,autoSize:{minRows:6,maxRows:12}})}),e(oe,{overlayStyle:{width:"280px"},placement:"top",open:z,onOpenChange:()=>Y(!z),content:ce.map(t=>e("span",{className:"inline-block cursor-pointer px-2 text-[20px] hover:bg-blue-400 w-5 h-8 rounded-md",onClick:()=>Se(t.emoji),children:t.emoji},t.id)),children:a("div",{className:"-mt-5 mb-1 flex items-center justify-center w-16 h-8 text-center rounded cursor-pointer border-1 border-solid border-base-200",style:{userSelect:"none"},children:[e("span",{children:e(le,{iconName:"icon-biaoqing",className:"text-[20px] text-[var(--color-icon-default)] pr-1"})}),e("span",{className:"text-[var(--color-icon-default)]",style:{userSelect:"none"},children:"表情"})]})}),e(i.Item,{className:"",children:a(E,{type:"primary",htmlType:"submit",className:"w-800 mx-auto lg:w-full sm:w-full",children:[e(Ie,{})," 提交留言"]})})]}),e(B,{className:"mt:h-4 w-full mx-auto lg:w-full sm:w-full",ref:D,children:a(v,{span:24,className:"sm:w-full lg:w-full",children:[a("b",{style:{marginBottom:"24px",color:"var(--color-icon-default)",userSelect:"none"},children:["留言展示 ",e(Ae,{})]}),c&&c.length>0?e(P,{itemLayout:"horizontal",className:"sm:w-full lg:w-full",dataSource:c&&c,renderItem:(t,n)=>{var m,N;return e(P.Item,{actions:[],children:e(P.Item.Meta,{avatar:t.nickName.trim()==="夜雨炊烟"?e(y,{style:{userSelect:"none"},src:"https://op.yychuiyan.com/avatar1511.webp"}):t.avatar?e(y,{style:{userSelect:"none"},src:t.avatar}):e(y,{style:{backgroundColor:"#1890ff",userSelect:"none"},children:(N=(m=t.nickName)==null?void 0:m.slice(0,1))==null?void 0:N.toUpperCase()}),title:e("b",{style:{color:"var(--color-icon-default)",userSelect:"none"},children:t.nickName}),description:a(re,{children:[e("div",{className:"user_content font-normal lg:w-full",children:e("pre",{className:"lg:overflow-auto",dangerouslySetInnerHTML:{__html:t.currentReplayContent.replace(/((http|https):\/\/[-A-Za-z0-9+&@#/%?=~_|!:,.;]+[-A-Za-z0-9+&@#/%=~_|])/g,s=>"<a href='"+s+"' target='_blank'>"+s+"</a>")}})}),a("div",{className:"sm:w-full lg:w-full",style:{fontSize:"12px",marginTop:"8px",marginBottom:"16px",alignItems:"center",display:"flex",flexWrap:"wrap",justifyContent:"space-between"},children:[a("span",{className:"user_desc",style:{userSelect:"none"},children:["用户 ",t.nickName,"  发表于 ",F(t.messageTime*1e3).format("YYYY-MM-DD HH:mm:ss")]}),e("span",{style:{userSelect:"none"},children:a("a",{style:{fontSize:"12px",marginRight:"12px"},onClick:()=>X(t),children:[e(ie,{}),"  回复"]})})]}),t.children&&t.children.length?e(re,{children:t.children.map((s,A)=>{var te,ae;return e(Be,{className:"bg-base-100",author:e("span",{className:"replay_title",style:{userSelect:"none"},children:s.targetReplayContent.substring(0,40)+"···"}),avatar:s.nickName.trim()==="夜雨炊烟"?e(y,{style:{userSelect:"none"},src:"https://op.yychuiyan.com/avatar1511.webp"}):s.avatar?e(y,{style:{userSelect:"none"},src:s.avatar}):e(y,{style:{backgroundColor:"#1890ff",userSelect:"none"},children:(ae=(te=s.nickName)==null?void 0:te.slice(0,1))==null?void 0:ae.toUpperCase()}),content:e("span",{className:"user_content font-normal",children:e("pre",{className:"lg:overflow-auto",dangerouslySetInnerHTML:{__html:s.currentReplayContent.replace(/((http|https):\/\/[-A-Za-z0-9+&@#/%?=~_|!:,.;]+[-A-Za-z0-9+&@#/%=~_|])/g,ne=>"<a href='"+ne+"' target='_blank'>"+ne+"</a>")}})}),datetime:e(Me,{title:s.messageTime,children:e("span",{style:{userSelect:"none"},children:F(F(s.messageTime*1e3).format("YYYY-MM-DD HH:mm:ss")).fromNow()})}),actions:[a("a",{style:{fontSize:"12px",marginRight:"12px",userSelect:"none"},onClick:()=>X(s),children:[e(ie,{}),"  回复"]})]},A)})}):null,l._id===t._id||l.pid===t._id?e("div",{style:{marginTop:"12px"},ref:w,children:a(i,{form:b,name:"reply",onFinish:be,onFinishFailed:G,children:[a(B,{children:[e(v,{span:12,className:"pr-2",children:e(i.Item,{label:"",name:"nickname",rules:[{required:!0,message:"请输入你的昵称"},{whitespace:!0,message:"输入不能为空"},{min:2,message:"昵称不能小于2个字符"},{max:30,message:"主题不能大于30个字符"}],children:e(f,{maxLength:30,placeholder:"请输入你的昵称"})})}),e(v,{span:12,className:"pl-2",children:e(i.Item,{label:"",name:"email",rules:[{required:!0,message:"请输入你的邮箱"},{pattern:/^[a-zA-Z0-9_.-]+@[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*\.[a-zA-Z0-9]{2,6}$/,message:"邮箱格式不正确"}],children:e(f,{maxLength:30,placeholder:"请输入你的邮箱"})})})]}),e(i.Item,{label:"",name:"content",children:e(f.TextArea,{placeholder:"请输入回复内容",onChange:Ce,value:I,autoSize:{minRows:6,maxRows:12}})}),e(oe,{overlayStyle:{width:"280px"},placement:"top",open:T,onOpenChange:()=>q(!T),content:ce.map(s=>e("span",{className:" inline-block cursor-pointer px-2 text-[20px] hover:bg-blue-400 w-5 h-8 rounded-md",onClick:()=>ve(s.emoji),children:s.emoji},s.id)),children:a("div",{className:"-mt-5 mb-1 flex items-center justify-center w-16 h-8 text-center rounded cursor-pointer border-1 border-solid border-base-200",style:{userSelect:"none"},children:[e("span",{children:e(le,{iconName:"icon-biaoqing",className:"text-[20px] text-[var(--color-icon-default)] pr-1"})}),e("span",{className:"text-[var(--color-icon-default)]",children:"表情"})]})}),e(i.Item,{children:a("div",{style:{display:"flex",justifyContent:"flex-end"},children:[e(E,{style:{marginRight:"12px"},onClick:()=>ee(),children:"取消"}),e(E,{type:"primary",htmlType:"submit",children:" 回复"})]})}),e(i.Item,{})]})}):null]})})},n)}}):e("div",{className:"flex justify-center",children:"暂无留言~"}),e(ze,{text:he,pageSize:O,currentPage:$,total:fe,onChange:we})]})})]})})]})};export{Ge as default};
