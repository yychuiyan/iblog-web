import{s as ue,w as fe,o as l,aG as i,R as ye,t as xe,p as n,q as e,H as be,aH as we,aI as Se,aJ as Z,aK as A,aL as x,aM as Q,I as X,aN as P,aO as b,aP as ee,T as Ne,v as Ce,u as T,B as ve}from"./index-2d9379ef.js";import{a as te,M as ke}from"./index-252a97fe.js";import{d as h}from"./dayjs.min-e81c0e7f.js";import{r as Ae,C as Te,e as ae,a as Re,b as ze,L as $,M as ne,c as Me}from"./emoji-47d48058.js";import{P as _e}from"./PageDesc-4706c239.js";import{S as je}from"./SoundOutlined-b1ed9ec5.js";const Ie=r=>{const[E,R]=l.useState([]),[s,w]=l.useState({_id:"",pid:"-1"}),[se,z]=l.useState(0),[S,M]=l.useState(1),[N,_]=l.useState(10),[j,le]=l.useState(1),[oe,Be]=l.useState("cm"),[C]=i.useForm(),[I]=i.useForm(),v=l.useRef(null);let[u,O]=l.useState();const[Y,q]=l.useState(!1),[B,V]=l.useState(!1);h.extend(Ae);const F=ye.useRef(),[L,U]=l.useState(""),[H,W]=l.useState("");l.useEffect(()=>{F.current&&window.scroll({top:F.current.offsetTop-80||0,left:0,behavior:"smooth"})},[]),l.useEffect(()=>{if(localStorage.getItem("zhj")==="success"&&localStorage.getItem("yychuiyan")!==null){const o=xe(localStorage.getItem("yychuiyan"));O(o)}else O(null)},[localStorage]),l.useEffect(()=>{r.BlogActions.asyncMessageListAction(S,N,1).then(t=>{let{data:o,totalCount:d,page:p,pageSize:a}=t.data;o.map(m=>{m.messageTime=h(m.messageTime*1e3).format("YYYY-MM-DD HH:mm:ss"),m.children.map(c=>{c.messageTime=h(c.messageTime*1e3).format("YYYY-MM-DD HH:mm:ss")})}),R(o),z(d),M(p),_(a)})},[S,N,r.BlogActions]);const ce=t=>{if(t.content===void 0||t.content==="")return T.warning("留言内容不能为空😯");r.BlogActions.asyncMessageInsertAction({pid:s.pid,targetReplayId:s._id||"-1",targetReplayContent:"",currentReplayContent:t.content,auditTime:0,auditStatus:"1",avatar:Boolean(u)?u.avatar:u,email:t.email,nickName:t.nickname}).then(()=>{setTimeout(()=>{T.success("留言成功~"),j===1&&I.resetFields(),j===2&&(w({_id:"",pid:"-1"}),C.resetFields()),r.BlogActions.asyncMessageListAction(S,N,1).then(m=>{let{data:c,totalCount:f,page:y,pageSize:D}=m.data;c.map(g=>{g.messageTime=h(g.messageTime*1e3).format("YYYY-MM-DD HH:mm:ss"),g.children.map(k=>{k.messageTime=h(k.messageTime*1e3).format("YYYY-MM-DD HH:mm:ss")})}),R(c),z(f),M(y),_(D)});let o="haoju.zhang@outlook.com",d=`您的博客收到来自${t.nickname}<${t.email}>的留言`,a=`<div><br /><p>您在<span style="color: cadetblue; padding: 3px">夜雨炊烟</span>博客上收到新的留言</p><hr /><span style="color: cadetblue;">${t.nickname}:</span><p style="width: 98%;min-height: 30px;padding-top: 10px;padding-left: 10px;padding-bottom: 10px;background-color: #f5f5f5;border-radius: 10px;"><span>${t.content}</span></p><p><a href="https://yychuiyan.com/message"target="_blank"style="text-decoration: none; color: #5c8fef">点击查看详情</a></p></div>`.split(`
`).join(`
<br/>
`);r.BlogActions.asyncSendMailAction({email:o,subject:d,html:a})},500)})},G=()=>{},J=t=>{w(t),C.resetFields(),v&&setTimeout(()=>{var o;(o=v==null?void 0:v.current)==null||o.scrollIntoView({behavior:"smooth",block:"center",inline:"center"})},100)},ie=t=>{if(t.content===void 0||t.content==="")return T.warning("回复内容不能为空😯");le(2),r.BlogActions.asyncMessageInsertAction({pid:s.pid==="-1"?s._id:s.pid,targetReplayId:s._id||"-1",targetReplayContent:`${t==null?void 0:t.nickname}@${s==null?void 0:s.nickName} ${s==null?void 0:s.currentReplayContent}`,currentReplayContent:t.content,auditTime:0,auditStatus:"1",avatar:Boolean(u)?u.avatar:u,email:t.email,nickName:t.nickname}).then(()=>{setTimeout(()=>{T.success("回复成功~"),j===1&&I.resetFields(),j===2&&(w({_id:"",pid:"-1"}),C.resetFields()),r.BlogActions.asyncMessageListAction(S,N,1).then(m=>{let{data:c,totalCount:f,page:y,pageSize:D}=m.data;c.map(g=>{g.messageTime=h(g.messageTime*1e3).format("YYYY-MM-DD HH:mm:ss"),g.children.map(k=>{k.messageTime=h(k.messageTime*1e3).format("YYYY-MM-DD HH:mm:ss")})}),R(c),w(c),z(f),M(y),_(D)});let o=s.email,d="您在夜雨炊烟小站中的留言收到了回复",a=`<div><br /><p>您在<span style="color: cadetblue; padding: 3px">夜雨炊烟</span>博客中的留言：</p><hr /><p style="width: 98%;min-height: 30px;padding-top: 10px;padding-left: 10px;padding-bottom: 10px;background-color: #f5f5f5;border-radius: 10px;"><span>${s.currentReplayContent}</span></p>收到<span style="color: cadetblue; padding-right:2px;">${t.nickname}</span>的回复:<p style="width: 98%;min-height: 30px;padding-top: 10px;padding-left: 10px;padding-bottom: 10px;background-color: #f5f5f5;border-radius: 10px;"><span>${t.content}</span></p><p><a href="https://yychuiyan.com/message"target="_blank"style="text-decoration: none; color: #5c8fef">点击查看详情</a></p></div>`.split(`
`).join(`
<br/>
`);r.BlogActions.asyncSendMailAction({email:o,subject:d,html:a})},500)}),K()},K=()=>{w({_id:"",pid:"-1"})},re=(t,o)=>{r.BlogActions.asyncArticleCommentsAction(t,o,1).then(d=>{let{data:p,totalCount:a,page:m,pageSize:c}=d.data;R(p),z(a),M(m),_(c)})},me=t=>{I.setFieldsValue({content:L.concat(t)}),U(L.concat(t)),q(!Y)},de=t=>{U(t.target.value)},pe=t=>{C.setFieldsValue({content:H.concat(t)}),W(H.concat(t)),V(!B)},he=t=>{W(t.target.value)},ge=`name: 夜雨炊烟
link: https://yychuiyan.com
avatar: https://op.yychuiyan.com/avatar.webp
desc: 三餐烟火暖，四季皆安然。`;return n("div",{className:"w-1200 mx-auto pb-5 lg:w-full lg:mx-5 sm:w-full",ref:F,children:[e(be,{children:e("title",{children:"留言板 | 夜雨炊烟"})}),e(_e,{title:"留言板"}),e("div",{className:"w-1000 mx-auto mt-10 lg:w-full sm:w-full",children:n(Te,{className:" rounded-2xl bg-base-100",children:[e("div",{style:{textAlign:"center",fontSize:"16px",fontWeight:"bolder",marginBottom:"24px",position:"relative"},className:"lg:w-full sm:w-full",children:e("div",{className:"h-36 px-20 mt-5 font-normal lg:px-0 lg:mt-1",children:n("div",{className:"flex flex-col items-start w-[100%]  absolute",children:[e("p",{className:"flex absolute text-xl",style:{userSelect:"none"},children:"本站信息:"}),n("div",{className:"flex items-start relative justify-center flex-col w-800 mt-8 bg-base-200  rounded-xl hover:transition hover:duration-500 hover:shadow cursor-pointer lg:w-full",style:{userSelect:"none"},children:[e("p",{className:"absolute right-2 top-2",onClick:()=>{navigator.clipboard.writeText(ge),T.info({content:"复制成功!",icon:e(je,{style:{color:"var(--bgcolor-social-default)"}}),className:"text-[var(--bgcolor-social-default)]"})},children:e(we,{icon:Se,size:"xl"})}),n("p",{className:"pl-2 py-1",children:[e("span",{children:"name: "}),e("span",{children:"夜雨炊烟"})]}),n("p",{className:"pl-2 pb-1",children:[e("span",{children:"link: "}),e("span",{children:"https://yychuiyan.com"})]}),n("p",{className:"pl-2 pb-1 lg:flex lg:flex-col lg:items-start",children:[e("span",{children:"avatar: "}),e("span",{children:"https://op.yychuiyan.com/avatar.webp"})]}),n("p",{className:"pl-2 pb-1",children:[e("span",{children:"desc: "}),e("span",{children:"三餐烟火暖，四季皆安然。"})]})]})]})})}),n(i,{name:"basic",form:I,onFinish:ce,onFinishFailed:G,className:"w-800 mx-auto  lg:w-full sm:w-full",children:[n(Z,{children:[e(A,{span:12,className:"pr-2 mt-5 lg:mt-8",children:e(i.Item,{label:"",name:"nickname",rules:[{required:!0,message:"请输入你的昵称"},{whitespace:!0,message:"输入不能为空"},{min:2,message:"昵称不能小于2个字符"},{max:30,message:"主题不能大于30个字符"}],children:e(x,{maxLength:30,placeholder:"请输入你的昵称"})})}),e(A,{span:12,className:"pl-2 mt-5 lg:mt-8",children:e(i.Item,{label:"",name:"email",rules:[{required:!0,message:"请输入你的邮箱"},{pattern:/^[a-zA-Z0-9_.-]+@[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*\.[a-zA-Z0-9]{2,6}$/,message:"邮箱格式不正确"}],children:e(x,{maxLength:30,placeholder:"请输入你的邮箱"})})})]}),e(i.Item,{label:"",name:"content",children:e(x.TextArea,{placeholder:"请输入留言内容",onChange:de,value:L,autoSize:{minRows:6,maxRows:12}})}),e(Q,{overlayStyle:{width:"280px"},placement:"top",open:Y,onOpenChange:()=>q(!Y),content:ae.map(t=>e("span",{className:"inline-block cursor-pointer px-2 text-[20px] hover:bg-blue-400 w-5 h-8 rounded-md",onClick:()=>me(t.emoji),children:t.emoji},t.id)),children:n("div",{className:"-mt-5 mb-1 flex items-center justify-center w-16 h-8 text-center rounded cursor-pointer border-1 border-solid border-base-200",style:{userSelect:"none"},children:[e("span",{children:e(X,{iconName:"icon-biaoqing",className:"text-[20px] text-[var(--color-icon-default)] pr-1"})}),e("span",{className:"text-[var(--color-icon-default)]",style:{userSelect:"none"},children:"表情"})]})}),e(i.Item,{className:"",children:n(P,{type:"primary",htmlType:"submit",className:"w-800 mx-auto lg:w-full sm:w-full",children:[e(Re,{})," 提交留言"]})})]}),e(Z,{className:"mt:h-4 w-full mx-auto lg:w-full sm:w-full",children:n(A,{span:24,className:"sm:w-full lg:w-full",children:[n("b",{style:{marginBottom:"24px",color:"var(--color-icon-default)",userSelect:"none"},children:["留言展示 ",e(ze,{})]}),E.length>0?e($,{itemLayout:"horizontal",className:"sm:w-full lg:w-full",dataSource:E,renderItem:(t,o)=>{var d,p;return e($.Item,{actions:[],children:e($.Item.Meta,{avatar:t.nickName.trim()==="夜雨炊烟"?e(b,{style:{userSelect:"none"},src:te}):Boolean(t.avatar)?e(b,{style:{userSelect:"none"},src:t.avatar}):e(b,{style:{backgroundColor:"#1890ff",userSelect:"none"},children:(p=(d=t.nickName)==null?void 0:d.slice(0,1))==null?void 0:p.toUpperCase()}),title:e("b",{style:{color:"var(--color-icon-default)",userSelect:"none"},children:t.nickName}),description:n(ee,{children:[e("div",{className:"user_content font-normal lg:w-full",children:e("pre",{className:"lg:overflow-auto",dangerouslySetInnerHTML:{__html:t.currentReplayContent.replace(/((http|https):\/\/[-A-Za-z0-9+&@#/%?=~_|!:,.;]+[-A-Za-z0-9+&@#/%=~_|])/g,a=>"<a href='"+a+"' target='_blank'>"+a+"</a>")}})}),n("div",{className:"sm:w-full lg:w-full",style:{fontSize:"12px",marginTop:"8px",marginBottom:"16px",alignItems:"center",display:"flex",flexWrap:"wrap",justifyContent:"space-between"},children:[n("span",{className:"user_desc",style:{userSelect:"none"},children:["用户 ",t.nickName,"  发表于 ",t.messageTime]}),e("span",{style:{userSelect:"none"},children:n("a",{style:{fontSize:"12px",marginRight:"12px"},onClick:()=>J(t),children:[e(ne,{}),"  回复"]})})]}),t.children&&t.children.length?e(ee,{children:t.children.map((a,m)=>{var c,f;return e(Me,{className:"bg-base-100",author:e("span",{className:"replay_title",style:{userSelect:"none"},children:a.targetReplayContent.substring(0,40)+"···"}),avatar:a.nickName.trim()==="夜雨炊烟"?e(b,{style:{userSelect:"none"},src:te}):Boolean(a.avatar)?e(b,{style:{userSelect:"none"},src:a.avatar}):e(b,{style:{backgroundColor:"#1890ff",userSelect:"none"},children:(f=(c=a.nickName)==null?void 0:c.slice(0,1))==null?void 0:f.toUpperCase()}),content:e("span",{className:"user_content font-normal",children:e("pre",{className:"lg:overflow-auto",dangerouslySetInnerHTML:{__html:a.currentReplayContent.replace(/((http|https):\/\/[-A-Za-z0-9+&@#/%?=~_|!:,.;]+[-A-Za-z0-9+&@#/%=~_|])/g,y=>"<a href='"+y+"' target='_blank'>"+y+"</a>")}})}),datetime:e(Ne,{title:a.messageTime,children:e("span",{style:{userSelect:"none"},children:h(a.messageTime).fromNow()})}),actions:[n("a",{style:{fontSize:"12px",marginRight:"12px",userSelect:"none"},onClick:()=>J(a),children:[e(ne,{}),"  回复"]})]},m)})}):null,s._id===t._id||s.pid===t._id?e("div",{style:{marginTop:"12px"},ref:v,children:n(i,{form:C,name:"reply",onFinish:ie,onFinishFailed:G,children:[n(Z,{children:[e(A,{span:12,className:"pr-2",children:e(i.Item,{label:"",name:"nickname",rules:[{required:!0,message:"请输入你的昵称"},{whitespace:!0,message:"输入不能为空"},{min:2,message:"昵称不能小于2个字符"},{max:30,message:"主题不能大于30个字符"}],children:e(x,{maxLength:30,placeholder:"请输入你的昵称"})})}),e(A,{span:12,className:"pl-2",children:e(i.Item,{label:"",name:"email",rules:[{required:!0,message:"请输入你的邮箱"},{pattern:/^[a-zA-Z0-9_.-]+@[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*\.[a-zA-Z0-9]{2,6}$/,message:"邮箱格式不正确"}],children:e(x,{maxLength:30,placeholder:"请输入你的邮箱"})})})]}),e(i.Item,{label:"",name:"content",children:e(x.TextArea,{placeholder:"请输入回复内容",onChange:he,value:H,autoSize:{minRows:6,maxRows:12}})}),e(Q,{overlayStyle:{width:"280px"},placement:"top",open:B,onOpenChange:()=>V(!B),content:ae.map(a=>e("span",{className:" inline-block cursor-pointer px-2 text-[20px] hover:bg-blue-400 w-5 h-8 rounded-md",onClick:()=>pe(a.emoji),children:a.emoji},a.id)),children:n("div",{className:"-mt-5 mb-1 flex items-center justify-center w-16 h-8 text-center rounded cursor-pointer border-1 border-solid border-base-200",style:{userSelect:"none"},children:[e("span",{children:e(X,{iconName:"icon-biaoqing",className:"text-[20px] text-[var(--color-icon-default)] pr-1"})}),e("span",{className:"text-[var(--color-icon-default)]",children:"表情"})]})}),e(i.Item,{children:n("div",{style:{display:"flex",justifyContent:"flex-end"},children:[e(P,{style:{marginRight:"12px"},onClick:()=>K(),children:"取消"}),e(P,{type:"primary",htmlType:"submit",children:" 回复"})]})}),e(i.Item,{})]})}):null]})})},o)}}):e("div",{className:"flex justify-center",children:"暂无留言~"}),e(ke,{text:oe,pageSize:N,currentPage:S,total:se,onChange:re})]})})]})})]})},Ye=r=>({BlogActions:Ce(ve,r)}),Ee=ue(null,Ye)(fe(Ie));export{Ee as default};
